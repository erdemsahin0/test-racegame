<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Nitro Lane Rush</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.js"></script>
</head>
<body>
<script>
class StartScene extends Phaser.Scene {
    constructor() {
        super('StartScene');
    }

    create() {
        this.add.text(400, 200, 'Nitro Lane Rush', { fontSize: '48px', fill: '#fff' }).setOrigin(0.5);
        this.add.text(400, 300, 'Press SPACE to Start', { fontSize: '24px', fill: '#fff' }).setOrigin(0.5);

        // This is a crucial line for handling keyboard input
        this.game.canvas.setAttribute('tabindex', '0');
        this.game.canvas.focus();

        this.input.keyboard.once('keydown-SPACE', () => {
            this.scene.start('GameScene');
        });
    }
}

class GameScene extends Phaser.Scene {
    constructor() {
        super('GameScene');
        this.playerSpeed = 300;
    }

    preload() {
        // (This function remains exactly the same)
        this.load.image('road', 'assets/road.png');
        this.load.image('player_car_hero', 'assets/player_car_hero.png');
        this.load.image('enemy_car_green', 'assets/enemy_car_green.png');
        this.load.image('enemy_car_yellow', 'assets/enemy_car_yellow.png');
        this.load.image('enemy_car_blue_sky', 'assets/enemy_car_blue_sky.png');
        this.load.image('enemy_car_police', 'assets/enemy_car_police.png');
    }

    create() {
        // Create a scrolling road background
        this.road = this.add.tileSprite(400, 300, 800, 600, 'road');

        // Create the player's car as a physics sprite
        this.car = this.physics.add.sprite(400, 500, 'player_car_hero');
        this.car.setCollideWorldBounds(true);

        // --- NEW: Shrink the player's hitbox ---
        // We make the body smaller than the image to feel more accurate.
        // setSize(width, height)
        this.car.body.setSize(60, 140);

        // NEW: Renamed from 'roadblocks' to 'enemyCars' for clarity
        this.enemyCars = this.physics.add.group();

        // A timed event to spawn a new enemy car every 1.5 seconds
        this.time.addEvent({
            delay: 1500,
            callback: this.spawnEnemyCar, // <-- Renamed function
            callbackScope: this,
            loop: true
        });

        // The collision handler for the player and the enemy cars
        this.physics.add.overlap(this.car, this.enemyCars, this.hitEnemy, null, this);

        this.cursors = this.input.keyboard.createCursorKeys();
    }

    // --- NEW: This function now spawns a random enemy car ---
    spawnEnemyCar() {
        const x = Phaser.Math.Between(100, 700);
        const y = -50;

        // NEW: Create an array of enemy car keys to choose from
        const carTypes = ['enemy_car_green', 'enemy_car_yellow', 'enemy_car_blue_sky'];
        // Randomly pick one of the car types
        const randomCarKey = Phaser.Math.RND.pick(carTypes);

        // Create an enemy car using the random key
        const enemyCar = this.enemyCars.create(x, y, randomCarKey);
        
        // --- NEW: Shrink the enemy's hitbox ---
        enemyCar.body.setSize(60, 110);
        
        // Set a downward velocity
        enemyCar.setVelocityY(150);
    }

    // NEW: Renamed for clarity
    hitEnemy(player, enemyCar) {
        console.log('CRASH!');
        this.scene.restart();
    }

    update() {
        this.road.tilePositionY -= 4;

        this.car.body.setVelocity(0);

        if (this.cursors.left.isDown) {
            this.car.body.setVelocityX(-this.playerSpeed);
        } else if (this.cursors.right.isDown) {
            this.car.body.setVelocityX(this.playerSpeed);
        }

        if (this.cursors.up.isDown) {
            this.car.body.setVelocityY(-this.playerSpeed);
        } else if (this.cursors.down.isDown) {
            this.car.body.setVelocityY(this.playerSpeed);
        }

        // Cleanup for enemy cars that go off-screen
        this.enemyCars.getChildren().forEach(enemyCar => {
            if (enemyCar.y > 650) {
                enemyCar.destroy();
            }
        });
    }
}

const config = {
    type: Phaser.AUTO,
    width: 800,
    height: 600,
    backgroundColor: '#222',
    // ADD THIS PHYSICS BLOCK
    physics: {
        default: 'arcade',
        arcade: {
            gravity: { y: 0 }, // No gravity for a top-down game
            debug: true // Set to true to see hitboxes
        }
    },
    scene: [StartScene, GameScene]
};

new Phaser.Game(config);
</script>
</body>
</html>
