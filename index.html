<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="utf-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Nitro Lane Rush — MVP</title>

  <style>

    html, body { height:100%; margin:0; background:#0e1117; }

    #game { width:100%; height:100%; }

    .hud { position: absolute; inset: 0; pointer-events: none; font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, 'DM Mono', monospace; }

    .hud .row { position: absolute; left: 0; right: 0; top: 0; display: flex; justify-content: space-between; padding: 12px 16px; color: #E6E6E6; font-weight: 600; }

    .hud .meter { position: absolute; left: 50%; transform: translateX(-50%); bottom: 12px; width: 50%; height: 10px; background: rgba(255,255,255,0.1); border-radius: 999px; overflow: hidden; }

    .hud .meter > span { display:block; height:100%; width:0%; background:#FF4C4C; transition: width 120ms linear; }

    .center-msg { position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); color:#E6E6E6; font-size:24px; font-weight:700; text-align:center; text-shadow:0 2px 8px rgba(0,0,0,.6); }

    .btn { position:absolute; left:50%; transform: translateX(-50%); bottom: 48px; padding:10px 14px; border-radius:12px; background:#60D7FF; color:#1F2430; font-weight:700; border:none; cursor:pointer; box-shadow: 0 8px 24px rgba(96,215,255,.25); }

  </style>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;600;700&family=DM+Mono:wght@500&display=swap" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.0/dist/phaser.min.js"></script>

</head>

<body>

  <div id="game"></div>

  <div class="hud">

    <div class="row"><div id="timer">⏱ 30.0</div><div id="score">0</div></div>

    <div class="meter"><span id="nitroBar"></span></div>

    <div class="center-msg" id="centerMsg">Tap / ← → to move lanes</div>

    <button class="btn" id="startBtn">Start</button>

  </div>



  <script>

  // --- Palette ---

  const PAL = {

    Asphalt: '#1F2430',

    LaneStripe: '#F5C84C',

    PlayerPrimary: '#FF4C4C',

    AccentGlass: '#60D7FF',

    NeutralLight: '#E6E6E6'

  };



  // --- SVG Assets (exactly from the provided kit) ---

  const SVG = {

    player: `<?xml version="1.0" encoding="UTF-8"?><svg xmlns='http://www.w3.org/2000/svg' width='128' height='128' viewBox='0 0 128 128'><g fill='none'><rect x='22' y='28' width='10' height='24' rx='4' fill='${PAL.Asphalt}'/><rect x='96' y='28' width='10' height='24' rx='4' fill='${PAL.Asphalt}'/><rect x='22' y='76' width='10' height='24' rx='4' fill='${PAL.Asphalt}'/><rect x='96' y='76' width='10' height='24' rx='4' fill='${PAL.Asphalt}'/><path d='M40 16h48c6 0 14 18 14 24v48c0 6-8 24-14 24H40c-6 0-14-18-14-24V40c0-6 8-24 14-24z' fill='${PAL.PlayerPrimary}'/><rect x='44' y='18' width='40' height='10' rx='4' fill='${PAL.NeutralLight}' opacity='0.35'/><rect x='44' y='100' width='40' height='10' rx='4' fill='${PAL.NeutralLight}' opacity='0.35'/><rect x='46' y='40' width='36' height='32' rx='8' fill='${PAL.AccentGlass}'/><rect x='42' y='74' width='44' height='12' rx='6' fill='${PAL.NeutralLight}' opacity='0.4'/><rect x='48' y='30' width='32' height='6' rx='3' fill='${PAL.Asphalt}' opacity='0.7'/><rect x='48' y='92' width='32' height='6' rx='3' fill='${PAL.Asphalt}' opacity='0.7'/></g></svg>`,

    sedan: `<?xml version="1.0" encoding="UTF-8"?><svg xmlns='http://www.w3.org/2000/svg' width='128' height='128' viewBox='0 0 128 128'><g fill='none'><rect x='20' y='32' width='12' height='22' rx='4' fill='${PAL.Asphalt}'/><rect x='96' y='32' width='12' height='22' rx='4' fill='${PAL.Asphalt}'/><rect x='20' y='74' width='12' height='22' rx='4' fill='${PAL.Asphalt}'/><rect x='96' y='74' width='12' height='22' rx='4' fill='${PAL.Asphalt}'/><rect x='36' y='20' width='56' height='88' rx='10' fill='${PAL.NeutralLight}'/><rect x='42' y='44' width='44' height='28' rx='6' fill='${PAL.AccentGlass}'/><rect x='40' y='24' width='48' height='6' rx='3' fill='${PAL.Asphalt}' opacity='0.5'/><rect x='40' y='98' width='48' height='6' rx='3' fill='${PAL.Asphalt}' opacity='0.5'/></g></svg>`,

    suv: `<?xml version="1.0" encoding="UTF-8"?><svg xmlns='http://www.w3.org/2000/svg' width='128' height='128' viewBox='0 0 128 128'><g fill='none'><rect x='18' y='30' width='14' height='24' rx='5' fill='${PAL.Asphalt}'/><rect x='96' y='30' width='14' height='24' rx='5' fill='${PAL.Asphalt}'/><rect x='18' y='74' width='14' height='24' rx='5' fill='${PAL.Asphalt}'/><rect x='96' y='74' width='14' height='24' rx='5' fill='${PAL.Asphalt}'/><rect x='32' y='18' width='64' height='92' rx='14' fill='${PAL.NeutralLight}'/><rect x='42' y='24' width='44' height='4' rx='2' fill='${PAL.Asphalt}' opacity='0.6'/><rect x='42' y='30' width='44' height='4' rx='2' fill='${PAL.Asphalt}' opacity='0.6'/><rect x='40' y='44' width='48' height='30' rx='6' fill='${PAL.AccentGlass}'/><rect x='38' y='98' width='52' height='6' rx='3' fill='${PAL.Asphalt}' opacity='0.6'/><rect x='38' y='24' width='52' height='6' rx='3' fill='${PAL.Asphalt}' opacity='0.6'/></g></svg>`,

    truck: `<?xml version="1.0" encoding="UTF-8"?><svg xmlns='http://www.w3.org/2000/svg' width='128' height='128' viewBox='0 0 128 128'><g fill='none'><rect x='18' y='34' width='14' height='22' rx='5' fill='${PAL.Asphalt}'/><rect x='96' y='34' width='14' height='22' rx='5' fill='${PAL.Asphalt}'/><rect x='18' y='78' width='14' height='22' rx='5' fill='${PAL.Asphalt}'/><rect x='96' y='78' width='14' height='22' rx='5' fill='${PAL.Asphalt}'/><rect x='34' y='24' width='30' height='80' rx='8' fill='${PAL.NeutralLight}'/><rect x='38' y='44' width='22' height='26' rx='6' fill='${PAL.AccentGlass}'/><rect x='64' y='20' width='34' height='88' rx='6' fill='${PAL.NeutralLight}'/><rect x='60' y='20' width='4' height='88' fill='${PAL.Asphalt}' opacity='0.5'/><rect x='66' y='100' width='30' height='6' rx='3' fill='${PAL.Asphalt}' opacity='0.6'/></g></svg>`,

    checkpoint: `<?xml version="1.0" encoding="UTF-8"?><svg xmlns='http://www.w3.org/2000/svg' width='128' height='128' viewBox='0 0 128 128'><g fill='none'><circle cx='64' cy='64' r='42' stroke='${PAL.AccentGlass}' stroke-width='12'/><circle cx='64' cy='64' r='20' fill='${PAL.LaneStripe}'/><path d='M56 56l16 8-16 8z' fill='${PAL.Asphalt}'/></g></svg>`,

    nitro: `<?xml version="1.0" encoding="UTF-8"?><svg xmlns='http://www.w3.org/2000/svg' width='128' height='128' viewBox='0 0 128 128'><g fill='none'><rect x='56' y='16' width='16' height='10' rx='3' fill='${PAL.Asphalt}'/><rect x='54' y='26' width='20' height='8' rx='4' fill='${PAL.Asphalt}' opacity='0.6'/><rect x='44' y='34' width='40' height='78' rx='12' fill='${PAL.PlayerPrimary}'/><path d='M48 88 L80 52' stroke='${PAL.NeutralLight}' stroke-width='10' stroke-linecap='round'/><text x='64' y='72' font-family='monospace' font-size='20' text-anchor='middle' fill='${PAL.NeutralLight}'>N</text></g></svg>`

  };



  function dataURI(svg) { return 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svg); }



  // --- Game Config ---

  const GAME_W = 432; // 3 lanes by default (144 each)

  const GAME_H = 768;

  const LANES = 3;

  const LANE_W = GAME_W / LANES;

  const SPEED_BASE = 220; // px/sec scroll speed



  const config = {

    type: Phaser.AUTO,

    width: GAME_W,

    height: GAME_H,

    parent: 'game',

    backgroundColor: PAL.Asphalt,

    physics: { default: 'arcade' },

    scene: { preload, create, update }

  };



  let game = new Phaser.Game(config);



  // Globals within scene scope

  let lanesX = [];

  let player, cursors, pointer,

      trafficGroup, pickupsGroup,

      score = 0, timeLeft = 30, running = false,

      nitro = 0, nitroActive = false, speed = SPEED_BASE,

      lastSpawn = 0;



  function preload() {

    // Load lane stripe texture (small dash pattern)

    this.textures.generate('stripe', { data: [

      '........',

      '........',

      '........',

      '........',

    ], pixelWidth: 1 });



    // Register SVGs as textures via data URIs

    this.load.image('player', dataURI(SVG.player));

    this.load.image('sedan', dataURI(SVG.sedan));

    this.load.image('suv', dataURI(SVG.suv));

    this.load.image('truck', dataURI(SVG.truck));

    this.load.image('checkpoint', dataURI(SVG.checkpoint));

    this.load.image('nitro', dataURI(SVG.nitro));

  }



  function create() {

    // Lane X coordinates

    for (let i = 0; i < LANES; i++) lanesX[i] = (LANE_W * i) + LANE_W/2;



    // Draw lane stripes as graphics tiling

    const g = this.add.graphics();

    g.lineStyle(6, Phaser.Display.Color.HexStringToColor(PAL.LaneStripe).color, 1);

    for (let i = 1; i < LANES; i++) {

      const x = i * LANE_W;

      for (let y = -40; y < GAME_H + 80; y += 48) {

        g.strokeLineShape(new Phaser.Geom.Line(x, y, x, y + 24));

      }

    }

    g.setAlpha(0.95);



    // Groups

    trafficGroup = this.physics.add.group();

    pickupsGroup = this.physics.add.group();



    // Player

    player = this.physics.add.image(lanesX[1], GAME_H - 140, 'player');

    player.setScale(0.7); // ~90px high

    player.setImmovable(true);

    player.body.setSize(player.width*0.6, player.height*0.8, true);



    // Controls

    cursors = this.input.keyboard.createCursorKeys();

    this.input.keyboard.addKeys('A,D');

    pointer = this.input.activePointer;



    // Collisions

    this.physics.add.overlap(player, trafficGroup, () => endRun.call(this), null, this);

    this.physics.add.overlap(player, pickupsGroup, onPickup, null, this);



    // UI

    document.getElementById('startBtn').onclick = () => startRun();

    updateHUD();

  }



  function startRun() {

    score = 0; timeLeft = 30; nitro = 0; nitroActive = false; speed = SPEED_BASE; lastSpawn = 0;

    running = true;

    document.getElementById('centerMsg').style.display = 'none';

    document.getElementById('startBtn').style.display = 'none';



    // Clear existing

    trafficGroup.clear(true, true);

    pickupsGroup.clear(true, true);

    player.x = lanesX[1];

  }



  function endRun() {

    running = false;

    document.getElementById('centerMsg').textContent = `Crashed! Score ${score}`;

    document.getElementById('centerMsg').style.display = 'block';

    document.getElementById('startBtn').textContent = 'Restart';

    document.getElementById('startBtn').style.display = 'inline-block';

  }



  function onPickup(player, item) {

    if (item.getData('type') === 'checkpoint') {

      timeLeft = Math.min(timeLeft + 5, 99);

      score += 5;

    } else if (item.getData('type') === 'nitro') {

      nitro = Math.min(nitro + 40, 100);

    }

    item.destroy();

    updateHUD();

  }



  function spawnTraffic(scene) {

    const types = ['sedan','suv','truck'];

    const key = Phaser.Utils.Array.GetRandom(types);

    const lane = Phaser.Math.Between(0, LANES-1);

    const x = lanesX[lane];

    const y = -120;

    const car = scene.physics.add.image(x, y, key);

    car.setScale(0.7);

    car.setVelocityY(speed * 1.0 + Phaser.Math.Between(-20, 40));

    car.setData('scorable', true);

    trafficGroup.add(car);



    // rarely spawn a pickup aligned to a different lane slot

    if (Math.random() < 0.25) {

      const pType = Math.random() < 0.6 ? 'checkpoint' : 'nitro';

      const pLane = (lane + Phaser.Math.Between(1, LANES-1)) % LANES;

      const item = scene.physics.add.image(lanesX[pLane], y - 120, pType);

      item.setScale(pType === 'checkpoint' ? 0.6 : 0.55);

      item.setVelocityY(speed * 1.02);

      item.setData('type', pType);

      pickupsGroup.add(item);

    }

  }



  function tryLaneChange(dir) {

    const idx = lanesX.findIndex(x => Math.abs(x - player.x) < 4);

    let target = Phaser.Math.Clamp(idx + dir, 0, LANES-1);

    if (target === idx) return;

    const tween = player.scene.tweens.add({ targets: player, x: lanesX[target], duration: 120, ease: 'Cubic.easeOut' });

  }



  function applyNitro(dt) {

    if (!nitroActive && nitro >= 25 && (cursors.space?.isDown)) {

      nitroActive = true;

    }

    if (nitroActive) {

      speed = Phaser.Math.Linear(speed, SPEED_BASE*2.1, 0.25);

      nitro -= 20 * dt; // drain per second

      if (nitro <= 0) { nitroActive = false; nitro = 0; }

      // brief screen shake

      player.scene.cameras.main.shake(40, 0.002);

    } else {

      speed = Phaser.Math.Linear(speed, SPEED_BASE, 0.08);

    }

  }



  function updateHUD() {

    document.getElementById('timer').textContent = `⏱ ${timeLeft.toFixed(1)}`;

    document.getElementById('score').textContent = `${score}`;

    document.getElementById('nitroBar').style.width = `${nitro}%`;

  }



  function update(time, delta) {

    const dt = delta / 1000;



    if (!running) return;



    // Input (keyboard)

    if (Phaser.Input.Keyboard.JustDown(cursors.left) || this.input.keyboard.checkDown(cursors.A, 1)) tryLaneChange(-1);

    if (Phaser.Input.Keyboard.JustDown(cursors.right) || this.input.keyboard.checkDown(cursors.D, 1)) tryLaneChange(1);



    // Input (pointer swipe/tap)

    if (pointer.isDown && pointer.getDuration() < 150 && pointer.justDown) {

      const dir = (pointer.downX < GAME_W/2) ? -1 : 1;

      tryLaneChange(dir);

    }



    // Spawn traffic

    lastSpawn += dt;

    const spawnEvery = Phaser.Math.FloatBetween(0.7, 1.1);

    if (lastSpawn > spawnEvery) { lastSpawn = 0; spawnTraffic(this); }



    // Move traffic & cleanup; scoring when passing beyond player

    trafficGroup.children.iterate(obj => {

      if (!obj) return;

      obj.setVelocityY(speed);

      if (obj.y > GAME_H + 160) obj.destroy();

      if (obj.getData('scorable') && obj.y > player.y) { obj.setData('scorable', false); score += 1; updateHUD(); }

    });



    pickupsGroup.children.iterate(it => { if (!it) return; it.setVelocityY(speed*1.02); if (it.y > GAME_H + 160) it.destroy(); });



    // Timer

    timeLeft -= dt; if (timeLeft <= 0) { timeLeft = 0; updateHUD(); endRun.call(this); } else if ((time*0.001)%0.1<dt) { updateHUD(); }



    // Nitro

    applyNitro(dt);

  }

  </script>

</body>

</html>
